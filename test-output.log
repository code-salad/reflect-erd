
> vsequel@2.1.0 test:ee
> docker compose -f test-ee/docker-compose.yml up -d --wait && npm run seed && npx tsx --test $(find test-ee -name '*.spec.ts') && docker compose -f test-ee/docker-compose.yml down

 Network test-ee_vsequel-network  Creating
 Network test-ee_vsequel-network  Created
 Container vsequel-postgres  Creating
 Container vsequel-mysql  Creating
 Container vsequel-mysql  Created
 Container vsequel-postgres  Created
 Container vsequel-postgres  Starting
 Container vsequel-mysql  Starting
 Container vsequel-postgres  Started
 Container vsequel-mysql  Started
 Container vsequel-mysql  Waiting
 Container vsequel-postgres  Waiting
 Container vsequel-mysql  Healthy
 Container vsequel-postgres  Healthy

> vsequel@2.1.0 seed
> npx tsx seeds/setup.ts

[38;5;142m[dotenvx@1.48.4] injecting env (3) from .env[39m
ðŸš€ Starting database setup...

ðŸŒ± Seeding PostgreSQL database...
ðŸŒ± Seeding MySQL database...
âœ… PostgreSQL database seeded successfully
âœ… MySQL database seeded successfully

âœ¨ Database setup completed successfully!

ðŸš€ Database setup complete!
TAP version 13
# [38;5;142m[dotenvx@1.48.4] injecting env (3) from .env[39m
# Subtest: CLI safe-query command
    # Subtest: help and validation
        # Subtest: should show help for safe-query command
        ok 1 - should show help for safe-query command
          ---
          duration_ms: 1115.774101
          type: 'test'
          ...
        # Subtest: should require database URL
        ok 2 - should require database URL
          ---
          duration_ms: 930.047711
          type: 'test'
          ...
        # Subtest: should require SQL query
        ok 3 - should require SQL query
          ---
          duration_ms: 630.562942
          type: 'test'
          ...
        # Subtest: should handle invalid database URL
        ok 4 - should handle invalid database URL
          ---
          duration_ms: 531.109928
          type: 'test'
          ...
        1..4
    ok 1 - help and validation
      ---
      duration_ms: 3208.868166
      type: 'suite'
      ...
    # Subtest: PostgreSQL integration tests
        # Subtest: should execute SELECT query successfully
        ok 1 - should execute SELECT query successfully
          ---
          duration_ms: 579.667051
          type: 'test'
          ...
        # Subtest: should execute complex SELECT with JOIN
        ok 2 - should execute complex SELECT with JOIN
          ---
          duration_ms: 605.506269
          type: 'test'
          ...
        # Subtest: should execute INSERT and rollback automatically
        ok 3 - should execute INSERT and rollback automatically
          ---
          duration_ms: 1169.015166
          type: 'test'
          ...
        # Subtest: should execute UPDATE and rollback automatically
        ok 4 - should execute UPDATE and rollback automatically
          ---
          duration_ms: 1157.783969
          type: 'test'
          ...
        # Subtest: should execute DELETE and rollback automatically
        ok 5 - should execute DELETE and rollback automatically
          ---
          duration_ms: 574.318551
          type: 'test'
          ...
        # Subtest: should handle SQL syntax errors gracefully
        ok 6 - should handle SQL syntax errors gracefully
          ---
          duration_ms: 529.663459
          type: 'test'
          ...
        # Subtest: should handle queries with special characters and quotes
        ok 7 - should handle queries with special characters and quotes
          ---
          duration_ms: 534.554003
          type: 'test'
          ...
        1..7
    ok 2 - PostgreSQL integration tests
      ---
      duration_ms: 5151.295121
      type: 'suite'
      ...
    # Subtest: MySQL integration tests
        # Subtest: should execute SELECT query on MySQL
        ok 1 - should execute SELECT query on MySQL
          ---
          duration_ms: 522.64428
          type: 'test'
          ...
        # Subtest: should execute INSERT and rollback on MySQL
        ok 2 - should execute INSERT and rollback on MySQL
          ---
          duration_ms: 1075.729414
          type: 'test'
          ...
        1..2
    ok 3 - MySQL integration tests
      ---
      duration_ms: 1598.880483
      type: 'suite'
      ...
    # Subtest: Cross-database compatibility
        # Subtest: should work with both PostgreSQL and MySQL
        ok 1 - should work with both PostgreSQL and MySQL
          ---
          duration_ms: 541.750123
          type: 'test'
          ...
        1..1
    ok 4 - Cross-database compatibility
      ---
      duration_ms: 542.046499
      type: 'suite'
      ...
    1..4
ok 1 - CLI safe-query command
  ---
  duration_ms: 10501.886109
  type: 'suite'
  ...
# Subtest: CLI Subcommands
    # Subtest: help command
        # Subtest: should show main help when no arguments provided
        ok 1 - should show main help when no arguments provided
          ---
          duration_ms: 990.907716
          type: 'test'
          ...
        # Subtest: should show help for schema subcommand
        ok 2 - should show help for schema subcommand
          ---
          duration_ms: 978.060488
          type: 'test'
          ...
        # Subtest: should show help for table subcommand
        ok 3 - should show help for table subcommand
          ---
          duration_ms: 698.655628
          type: 'test'
          ...
        # Subtest: should show help for list subcommand
        ok 4 - should show help for list subcommand
          ---
          duration_ms: 517.731011
          type: 'test'
          ...
        # Subtest: should show help for sample subcommand
        ok 5 - should show help for sample subcommand
          ---
          duration_ms: 561.757267
          type: 'test'
          ...
        # Subtest: should show help for context subcommand
        ok 6 - should show help for context subcommand
          ---
          duration_ms: 592.288284
          type: 'test'
          ...
        # Subtest: should show help for join subcommand
        ok 7 - should show help for join subcommand
          ---
          duration_ms: 562.840013
          type: 'test'
          ...
        # Subtest: should show help for safe-query subcommand
        ok 8 - should show help for safe-query subcommand
          ---
          duration_ms: 564.975298
          type: 'test'
          ...
        # Subtest: should show help for info subcommand
        ok 9 - should show help for info subcommand
          ---
          duration_ms: 518.904917
          type: 'test'
          ...
        1..9
    ok 1 - help command
      ---
      duration_ms: 5988.095311
      type: 'suite'
      ...
    # Subtest: error handling
        # Subtest: should error when database URL is missing for schema
        ok 1 - should error when database URL is missing for schema
          ---
          duration_ms: 565.222818
          type: 'test'
          ...
        # Subtest: should error when database URL is missing for list
        ok 2 - should error when database URL is missing for list
          ---
          duration_ms: 548.737248
          type: 'test'
          ...
        # Subtest: should error when table is missing for table command
        ok 3 - should error when table is missing for table command
          ---
          duration_ms: 540.815703
          type: 'test'
          ...
        # Subtest: should error when table is missing for sample command
        ok 4 - should error when table is missing for sample command
          ---
          duration_ms: 507.118176
          type: 'test'
          ...
        # Subtest: should error when table is missing for context command
        ok 5 - should error when table is missing for context command
          ---
          duration_ms: 512.242636
          type: 'test'
          ...
        # Subtest: should error when tables is missing for join command
        ok 6 - should error when tables is missing for join command
          ---
          duration_ms: 501.850967
          type: 'test'
          ...
        # Subtest: should error when database URL is missing for safe-query
        ok 7 - should error when database URL is missing for safe-query
          ---
          duration_ms: 499.909393
          type: 'test'
          ...
        # Subtest: should error when SQL is missing for safe-query command
        ok 8 - should error when SQL is missing for safe-query command
          ---
          duration_ms: 545.87581
          type: 'test'
          ...
        # Subtest: should error for unknown subcommand
        ok 9 - should error for unknown subcommand
          ---
          duration_ms: 510.555929
          type: 'test'
          ...
        1..9
    ok 2 - error handling
      ---
      duration_ms: 4733.174935
      type: 'suite'
      ...
    # Subtest: backward compatibility removed
        # Subtest: should show main help when --help without subcommand
        ok 1 - should show main help when --help without subcommand
          ---
          duration_ms: 487.101095
          type: 'test'
          ...
        # Subtest: should require explicit command
        ok 2 - should require explicit command
          ---
          duration_ms: 493.157169
          type: 'test'
          ...
        1..2
    ok 3 - backward compatibility removed
      ---
      duration_ms: 980.574435
      type: 'suite'
      ...
    # Subtest: output format validation
        # Subtest: should validate output format for schema command
        ok 1 - should validate output format for schema command
          ---
          duration_ms: 508.156497
          type: 'test'
          ...
        1..1
    ok 4 - output format validation
      ---
      duration_ms: 508.429899
      type: 'suite'
      ...
    1..4
ok 2 - CLI Subcommands
  ---
  duration_ms: 12210.991362
  type: 'suite'
  ...
# Subtest: CLI Integration Tests with Mock Database
    # Subtest: should list tables
    ok 1 - should list tables
      ---
      duration_ms: 510.696054
      type: 'test'
      ...
    # Subtest: should get table schema
    ok 2 - should get table schema
      ---
      duration_ms: 494.575095
      type: 'test'
      ...
    # Subtest: should get sample data
    ok 3 - should get sample data
      ---
      duration_ms: 486.150397
      type: 'test'
      ...
    # Subtest: should get table context
    ok 4 - should get table context
      ---
      duration_ms: 490.993694
      type: 'test'
      ...
    # Subtest: should find join path
    ok 5 - should find join path
      ---
      duration_ms: 479.195255
      type: 'test'
      ...
    # Subtest: should generate SQL join statements
    ok 6 - should generate SQL join statements
      ---
      duration_ms: 489.585932
      type: 'test'
      ...
    # Subtest: should execute safe query with SELECT
    ok 7 - should execute safe query with SELECT
      ---
      duration_ms: 483.855211
      type: 'test'
      ...
    # Subtest: should execute safe query with INSERT (rolled back)
    ok 8 - should execute safe query with INSERT (rolled back)
      ---
      duration_ms: 491.744822
      type: 'test'
      ...
    # Subtest: should execute safe query with UPDATE (rolled back)
    ok 9 - should execute safe query with UPDATE (rolled back)
      ---
      duration_ms: 490.266254
      type: 'test'
      ...
    # Subtest: should get database info
    ok 10 - should get database info
      ---
      duration_ms: 488.577825
      type: 'test'
      ...
    1..10
ok 3 - CLI Integration Tests with Mock Database
  ---
  duration_ms: 4906.347013
  type: 'suite'
  ...
# [38;5;142m[dotenvx@1.48.4] injecting env (3) from .env[39m
# Subtest: CLI tests
    # Subtest: should show help when --help flag is provided
    ok 1 - should show help when --help flag is provided
      ---
      duration_ms: 1086.037782
      type: 'test'
      ...
    # Subtest: should show help when no command is provided
    ok 2 - should show help when no command is provided
      ---
      duration_ms: 849.926559
      type: 'test'
      ...
    # Subtest: should validate output format
    ok 3 - should validate output format
      ---
      duration_ms: 614.874141
      type: 'test'
      ...
    # Subtest: should output JSON format
    ok 4 - should output JSON format
      ---
      duration_ms: 649.226854
      type: 'test'
      ...
    # Subtest: should output simple PlantUML format
    ok 5 - should output simple PlantUML format
      ---
      duration_ms: 659.625935
      type: 'test'
      ...
    # Subtest: should output full PlantUML format (default)
    ok 6 - should output full PlantUML format (default)
      ---
      duration_ms: 671.974096
      type: 'test'
      ...
    # Subtest: should use full plantuml as default output format
    ok 7 - should use full plantuml as default output format
      ---
      duration_ms: 1263.532442
      type: 'test'
      ...
    # Subtest: should handle database connection errors gracefully
    ok 8 - should handle database connection errors gracefully
      ---
      duration_ms: 554.118782
      type: 'test'
      ...
    # Subtest: should report success message to stderr
    ok 9 - should report success message to stderr
      ---
      duration_ms: 648.422299
      type: 'test'
      ...
    1..9
ok 4 - CLI tests
  ---
  duration_ms: 6999.916038
  type: 'suite'
  ...
# [38;5;142m[dotenvx@1.48.4] injecting env (3) from .env[39m
# Subtest: docker integration tests
    # Subtest: PostgreSQL tests
        # Subtest: should connect and pull schema from PostgreSQL
        ok 1 - should connect and pull schema from PostgreSQL
          ---
          duration_ms: 294.778395
          type: 'test'
          ...
        # Subtest: should pull sample data from PostgreSQL table
        ok 2 - should pull sample data from PostgreSQL table
          ---
          duration_ms: 27.125461
          type: 'test'
          ...
        # Subtest: should handle PostgreSQL views
        ok 3 - should handle PostgreSQL views
          ---
          duration_ms: 187.728991
          type: 'test'
          ...
        # Subtest: should handle multiple PostgreSQL schemas
        ok 4 - should handle multiple PostgreSQL schemas
          ---
          duration_ms: 208.712172
          type: 'test'
          ...
        # Subtest: should find shortest join path between two directly connected tables
        ok 5 - should find shortest join path between two directly connected tables
          ---
          duration_ms: 358.936805
          type: 'test'
          ...
        # Subtest: should find path with intermediate table
        ok 6 - should find path with intermediate table
          ---
          duration_ms: 290.762387
          type: 'test'
          ...
        # Subtest: should connect multiple tables
        ok 7 - should connect multiple tables
          ---
          duration_ms: 258.162525
          type: 'test'
          ...
        # Subtest: should handle single table input
        ok 8 - should handle single table input
          ---
          duration_ms: 51.948331
          type: 'test'
          ...
        # Subtest: should return null for empty input
        ok 9 - should return null for empty input
          ---
          duration_ms: 0.515356
          type: 'test'
          ...
        # Subtest: should handle tables from different schemas
        ok 10 - should handle tables from different schemas
          ---
          duration_ms: 108.796108
          type: 'test'
          ...
        1..10
    ok 1 - PostgreSQL tests
      ---
      duration_ms: 1790.137842
      type: 'suite'
      ...
    # Subtest: MySQL tests
        # Subtest: should connect and pull schema from MySQL
        ok 1 - should connect and pull schema from MySQL
          ---
          duration_ms: 56.287818
          type: 'test'
          ...
        # Subtest: should pull sample data from MySQL table
        ok 2 - should pull sample data from MySQL table
          ---
          duration_ms: 4.856125
          type: 'test'
          ...
        # Subtest: should handle MySQL views
        ok 3 - should handle MySQL views
          ---
          duration_ms: 38.652901
          type: 'test'
          ...
        # Subtest: should handle empty MySQL table
        ok 4 - should handle empty MySQL table
          ---
          duration_ms: 3.366344
          type: 'test'
          ...
        # Subtest: should handle MySQL table with foreign keys
        ok 5 - should handle MySQL table with foreign keys
          ---
          duration_ms: 35.610984
          type: 'test'
          ...
        # Subtest: should find shortest join path between MySQL tables
        ok 6 - should find shortest join path between MySQL tables
          ---
          duration_ms: 58.946267
          type: 'test'
          ...
        # Subtest: should find path with intermediate table in MySQL
        ok 7 - should find path with intermediate table in MySQL
          ---
          duration_ms: 46.74163
          type: 'test'
          ...
        # Subtest: should connect multiple MySQL tables
        ok 8 - should connect multiple MySQL tables
          ---
          duration_ms: 45.234336
          type: 'test'
          ...
        # Subtest: should handle nullable foreign keys in MySQL
        ok 9 - should handle nullable foreign keys in MySQL
          ---
          duration_ms: 37.454566
          type: 'test'
          ...
        # Subtest: should handle MySQL single table input
        ok 10 - should handle MySQL single table input
          ---
          duration_ms: 7.30495
          type: 'test'
          ...
        # Subtest: should return null for unconnected MySQL tables
        ok 11 - should return null for unconnected MySQL tables
          ---
          duration_ms: 33.589768
          type: 'test'
          ...
        1..11
    ok 2 - MySQL tests
      ---
      duration_ms: 368.944643
      type: 'suite'
      ...
    # Subtest: Cross-database comparison
        # Subtest: should have similar table structures in both databases
        ok 1 - should have similar table structures in both databases
          ---
          duration_ms: 142.909496
          type: 'test'
          ...
        # Subtest: should retrieve similar sample data from both databases
        ok 2 - should retrieve similar sample data from both databases
          ---
          duration_ms: 18.78986
          type: 'test'
          ...
        1..2
    ok 3 - Cross-database comparison
      ---
      duration_ms: 162.036198
      type: 'suite'
      ...
    1..3
ok 5 - docker integration tests
  ---
  duration_ms: 2321.802493
  type: 'suite'
  ...
# [38;5;142m[dotenvx@1.48.4] injecting env (3) from .env[39m
# Subtest: generatePlantumlSchema
    # Subtest: should generate PlantUML for PostgreSQL schema
    ok 1 - should generate PlantUML for PostgreSQL schema
      ---
      duration_ms: 289.230093
      type: 'test'
      ...
    # Subtest: should generate PlantUML for MySQL schema
    ok 2 - should generate PlantUML for MySQL schema
      ---
      duration_ms: 192.59239
      type: 'test'
      ...
    # Subtest: should handle foreign key relationships
    ok 3 - should handle foreign key relationships
      ---
      duration_ms: 233.53539
      type: 'test'
      ...
    # Subtest: should escape special characters in table names
    ok 4 - should escape special characters in table names
      ---
      duration_ms: 200.535287
      type: 'test'
      ...
    # Subtest: should return full PlantUML using getPlantuml method with type "full"
    ok 5 - should return full PlantUML using getPlantuml method with type "full"
      ---
      duration_ms: 228.357042
      type: 'test'
      ...
    # Subtest: should return simplified PlantUML using getPlantuml method with type "simple"
    ok 6 - should return simplified PlantUML using getPlantuml method with type "simple"
      ---
      duration_ms: 198.425015
      type: 'test'
      ...
    # Subtest: should default to full PlantUML when no type parameter is provided
    ok 7 - should default to full PlantUML when no type parameter is provided
      ---
      duration_ms: 144.356735
      type: 'test'
      ...
    # Subtest: should work with MySQL using getPlantuml method
    ok 8 - should work with MySQL using getPlantuml method
      ---
      duration_ms: 153.849444
      type: 'test'
      ...
    1..8
ok 6 - generatePlantumlSchema
  ---
  duration_ms: 1649.027675
  type: 'suite'
  ...
# [38;5;142m[dotenvx@1.48.4] injecting env (3) from .env[39m
# Subtest: database pull sample data
    # Subtest: should pull sample data from postgres table
    ok 1 - should pull sample data from postgres table
      ---
      duration_ms: 331.316143
      type: 'test'
      ...
    # Subtest: should pull sample data from mysql table
    ok 2 - should pull sample data from mysql table
      ---
      duration_ms: 197.932781
      type: 'test'
      ...
    # Subtest: should handle postgres table without schema prefix
    ok 3 - should handle postgres table without schema prefix
      ---
      duration_ms: 238.05231
      type: 'test'
      ...
    # Subtest: should handle mysql table without schema prefix
    ok 4 - should handle mysql table without schema prefix
      ---
      duration_ms: 121.122861
      type: 'test'
      ...
    # Subtest: should return empty array for empty postgres table
    ok 5 - should return empty array for empty postgres table
      ---
      duration_ms: 287.224912
      type: 'test'
      ...
    # Subtest: should return empty array for empty mysql table
    ok 6 - should return empty array for empty mysql table
      ---
      duration_ms: 155.59383
      type: 'test'
      ...
    1..6
ok 7 - database pull sample data
  ---
  duration_ms: 1332.837855
  type: 'suite'
  ...
# [38;5;142m[dotenvx@1.48.4] injecting env (3) from .env[39m
# Subtest: database pull schema
    # Subtest: should pull postgres schema from database
    ok 1 - should pull postgres schema from database
      ---
      duration_ms: 297.960333
      type: 'test'
      ...
    # Subtest: should pull mysql schema from database
    ok 2 - should pull mysql schema from database
      ---
      duration_ms: 194.850679
      type: 'test'
      ...
    1..2
ok 8 - database pull schema
  ---
  duration_ms: 494.355705
  type: 'suite'
  ...
# [38;5;142m[dotenvx@1.48.4] injecting env (3) from .env[39m
# Subtest: safeQuery method tests
    # Subtest: PostgreSQL safeQuery tests
        # Subtest: should execute SELECT query and return results
        ok 1 - should execute SELECT query and return results
          ---
          duration_ms: 48.816043
          type: 'test'
          ...
        # Subtest: should execute aggregate query and return results
        ok 2 - should execute aggregate query and return results
          ---
          duration_ms: 23.775326
          type: 'test'
          ...
        # Subtest: should execute JOIN query and return results
        ok 3 - should execute JOIN query and return results
          ---
          duration_ms: 25.471994
          type: 'test'
          ...
        # Subtest: should rollback INSERT operations - no data persisted
        ok 4 - should rollback INSERT operations - no data persisted
          ---
          duration_ms: 233.097237
          type: 'test'
          ...
        # Subtest: should rollback UPDATE operations - no data modified
        ok 5 - should rollback UPDATE operations - no data modified
          ---
          duration_ms: 80.369978
          type: 'test'
          ...
        # Subtest: should handle query errors gracefully
        ok 6 - should handle query errors gracefully
          ---
          duration_ms: 20.613155
          type: 'test'
          ...
        # Subtest: should handle syntax error gracefully
        ok 7 - should handle syntax error gracefully
          ---
          duration_ms: 33.93275
          type: 'test'
          ...
        1..7
    ok 1 - PostgreSQL safeQuery tests
      ---
      duration_ms: 467.956505
      type: 'suite'
      ...
    # Subtest: MySQL safeQuery tests
        # Subtest: should execute SELECT query and return results
        ok 1 - should execute SELECT query and return results
          ---
          duration_ms: 101.762572
          type: 'test'
          ...
        # Subtest: should execute aggregate query and return results
        ok 2 - should execute aggregate query and return results
          ---
          duration_ms: 13.077472
          type: 'test'
          ...
        # Subtest: should rollback INSERT operations - no data persisted
        ok 3 - should rollback INSERT operations - no data persisted
          ---
          duration_ms: 40.284877
          type: 'test'
          ...
        # Subtest: should rollback UPDATE operations - no data modified
        ok 4 - should rollback UPDATE operations - no data modified
          ---
          duration_ms: 26.358995
          type: 'test'
          ...
        # Subtest: should handle query errors gracefully
        ok 5 - should handle query errors gracefully
          ---
          duration_ms: 7.937505
          type: 'test'
          ...
        1..5
    ok 2 - MySQL safeQuery tests
      ---
      duration_ms: 190.247349
      type: 'suite'
      ...
    # Subtest: Cross-database transaction behavior
        # Subtest: should ensure consistent rollback behavior across databases
        ok 1 - should ensure consistent rollback behavior across databases
          ---
          duration_ms: 94.343008
          type: 'test'
          ...
        1..1
    ok 3 - Cross-database transaction behavior
      ---
      duration_ms: 100.037422
      type: 'suite'
      ...
    1..3
ok 9 - safeQuery method tests
  ---
  duration_ms: 759.149918
  type: 'suite'
  ...
1..9
# tests 106
# suites 23
# pass 106
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 17426.412805
 Container vsequel-postgres  Stopping
 Container vsequel-mysql  Stopping
 Container vsequel-postgres  Stopped
 Container vsequel-postgres  Removing
 Container vsequel-postgres  Removed
 Container vsequel-mysql  Stopped
 Container vsequel-mysql  Removing
 Container vsequel-mysql  Removed
 Network test-ee_vsequel-network  Removing
 Network test-ee_vsequel-network  Removed
